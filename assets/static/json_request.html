<html>
<head>
    <title>Click link to send JSON</title>
</head>
<body>

<div id="link"></div>
<div id="post"></div>
<div id="pre"></div>

<script>

  // Objective here is to demonstrate Elixir JSON Mutation

  var acc = "<pre>";
  acc += JSON.stringify(getJSON(), null, " ");
  acc += "</pre>";

  sendJSONLink()

  function startOverLink(){
    return "<a href=\"json_request.html\">Start Over!</a> or <a href=\"/\">Home</a>";
  }

  function sendJSONLink(){
    var link = "<a href=\"#\" onclick=\"sendJSON(getJSON())\">Send Original JSON!</a> or <a href=\"/\">Home</a>";
    document.getElementById("link").innerHTML = link;
    document.getElementById("pre").innerHTML = acc;
  }

  function sendJSON(json){

      var ajax = new XMLHttpRequest();
      ajax.open("POST", "/organize");
      ajax.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
      ajax.send(JSON.stringify(json));
      ajax.addEventListener("load", function(event){finished(event);}, false);

      console.log("Sent Data" + json);
  }

  function finished(e){
      console.log("finished: " + e.target.responseText);

      var acc = "Server responed with: <br>";
      acc += "<pre>";
      acc += JSON.stringify(JSON.parse(e.target.responseText), null, " "); // clean it
      acc += "</pre>";

      document.getElementById("pre").innerHTML = "";
      document.getElementById("post").innerHTML = acc;
      document.getElementById("link").innerHTML = startOverLink();

  }

  function getJSON(){
      return {"0":
          [{"id": 10,
              "title": "House",
              "level": 0,
              "children": [],
              "parent_id": null}],
          "1":
              [{"id": 12,
                  "title": "Red Roof",
                  "level": 1,
                  "children": [],
                  "parent_id": 10},
                  {"id": 18,
                      "title": "Blue Roof",
                      "level": 1,
                      "children": [],
                      "parent_id": 10},
                  {"id": 13,
                      "title": "Wall",
                      "level": 1,
                      "children": [],
                      "parent_id": 10}],
          "2":
              [{"id": 17,
                  "title": "Blue Window",
                  "level": 2,
                  "children": [],
                  "parent_id": 12},
                  {"id": 16,
                      "title": "Door",
                      "level": 2,
                      "children": [],
                      "parent_id": 13},
                  {"id": 15,
                      "title": "Red Window",
                      "level": 2,
                      "children": [],
                      "parent_id": 12}]}

  }

</script>

</body>
</html>